# =============================================================================
# AI News Assistant - Centralized Configuration
# =============================================================================
#
# This is the single source of truth for all non-secret settings.
# 
# To find settings:
#   - Frontend behavior → frontend section
#   - AI models & processing → backend section  
#   - LLM prompts → prompts section
#   - Secrets (API keys) → backend/.env
#
# =============================================================================

# =============================================================================
# FRONTEND
# =============================================================================
frontend:
  # State persistence expiration in ms (24 hours)
  playbackStateExpirationMs: 86400000
  qa:
    # Delay in ms before resuming newsletter after Q&A answer ends
    resumeDelayMs: 1500
    # Maximum duration for recording a question (30 seconds)
    maxRecordingDurationMs: 30000

# =============================================================================
# VOICE MODE (shared frontend/backend)
# =============================================================================
voiceMode:
  model: "gemini-live-2.5-flash-native-audio"
  region: "us-central1"
  # Session timeout for client reconnection logic (14 minutes)
  sessionTimeoutMs: 840000
  # Client-side VAD sensitivity tuning (Silero VAD)
  vadSensitivity:
    positiveSpeechThreshold: 0.6
    negativeSpeechThreshold: 0.3
    minSpeechFrames: 4
  # Delay before resuming newsletter after voice Q&A
  resumeDelayMs: 1200

# =============================================================================
# BACKEND
# =============================================================================
backend:
  processing:
    # Number of topic groups to process in parallel
    maxConcurrentSegments: 5
    # HTTP client timeout for fetching newsletters
    httpTimeoutSeconds: 30.0
    # Batch size for inserting segments into database
    segmentBatchSize: 50
    # RSS Feed URL for newsletter discovery
    rssUrl: "https://news.smol.ai/rss.xml"
  
  ai:
    models:
      # Model for cleaning newsletter text for TTS (needs high reasoning)
      # Gemini 3 Pro Preview requires global region, 
      # so currently set location="global" in code
      textCleaning: "gemini-3-pro-preview"
      # Model for Q&A (transcribe + answer) 
      qa: "gemini-2.5-flash-lite"
  
  tts:
    voiceName: "en-US-Chirp3-HD-Aoede"
    languageCode: "en-US"
    speakingRate: 1.0

# =============================================================================
# PROMPTS
# =============================================================================
prompts:
  textCleaning: |
    Clean the following list of newsletter texts for text-to-speech.
    Return a JSON array of strings, where each string corresponds to the input text at the same index.

    Rules:
    1. Replace "@username" with "[username] tweeted"
    2. Replace "/r/subreddit" with "the [subreddit] subreddit"
    3. For markdown links [text](url), keep only the text
    4. If a text seems to be a header, keep it conversational (e.g. prefix with "Now:")
    5. Keep natural
    6. OUTPUT MUST BE A VALID JSON ARRAY OF STRINGS with exactly {count} elements.

    <texts_to_clean>
    {texts_json}
    </texts_to_clean>

  qaWithAudio: |
    You are an AI assistant helping a user listen to a newsletter.
    The user is listening to a newsletter with the following content:

    <content>
    {context}
    </content>

    The user asked a question via audio. First, transcribe what the user said, then answer their question based ONLY on the content above.

    Format your response as:
    TRANSCRIPT: [what the user said]
    ANSWER: [your answer to their question]

    Keep the answer conversational, concise, and suitable for audio playback (text-to-speech).
    Do not use markdown formatting like bold or lists, as it will be read aloud.
    If the answer is not in the content, say so politely.
    If the audio is silent or unintelligible, set TRANSCRIPT to '[unintelligible]' and ANSWER to a polite request for the user to repeat the question.

  voiceMode: |
    You are a voice assistant for a newsletter audio player.
    The ONLY tools you can call are: play, pause, next, previous, bookmark, rewind, forward.
    If the user's utterance is a control command for playback (including polite wrappers like "please play" or "can you pause"), ALWAYS call the matching tool and say nothing else.
    DO NOT response with "Let me check".
    If the utterance is not clearly one of those commands, treat it as a question and answer using ONLY the content below.
    If the answer is not in the content, say so politely.
    Keep the answer within 50 words.
    

    <newsletter>
    {context}
    </newsletter>
